var presentation;var presentz;var headerPoll;headerPoll=setInterval(function(){if($('.video-player object').find('[name="flashvars"]').length!==0){var params=$('.video-player object').find('[name="flashvars"]').attr('value');var imageUrl=getParam(params,'stillUrl');var baseImageUrl=imageUrl.split('=')[0];var width=1000;var height=400;var realImageUrl=baseImageUrl+'='+width+'x'+height;var styles={backgroundImage:'url('+realImageUrl+')'};$('.video .post-header').css(styles);function getParam(params,paramName){var vars=params.split('&');for(var i=0;i<vars.length;i++){var pair=vars[i].split('=');if(pair[0]===paramName){return decodeURIComponent(pair[1]);}}}
clearInterval(headerPoll);}else if($('#video-player').find('img').length!==0){var realImageUrl=$("#video-player").find('img[id^="wistia"][id$="thumbnail_img"]')[0].src
var styles={backgroundImage:'url('+realImageUrl+')'};$('.video .post-header').css(styles);}},500);function setupVideo(prerollID,slideSyncFile){if(prerollID===""){prerollID="----------";}
function initPresentz(pres){presentation=pres;presentz=new Presentz("#video-player","555x450","#slideshow-player","555x450");presentz.init(presentation);presentz.on("slidechange",function(prevChap,prevSlide,chap,slide){$("#chapter").text("At chapter "+chap+", slide "+slide);});presentz.changeChapter(0,0,false,function(err){if(err){alert(err);}});}
function initPreroll(wistiaID){if(wistiaID==="----------"){return;}
return;var prerollEmbed=Wistia.embed(wistiaID,{videoFoam:true,chromeless:true,container:"preroll-player"});prerollEmbed.hasData(function(){var prerollPlayer=$(".preroll-player");var duration=prerollEmbed.duration();prerollEmbed.bind("timechange",function(t){var secondsLeft=prerollEmbed.duration()-t;if(secondsLeft<1){prerollPlayer.fadeTo(300,Math.max(secondsLeft,0),'linear');}});prerollEmbed.bind("crosstime",duration-1,function(){presentz.play();});prerollEmbed.bind("pause",function(){var secondsLeft=duration-prerollEmbed.time();if(secondsLeft<1&&secondsLeft>0){presentz.pause();}});prerollEmbed.bind("play",function(){var secondsLeft=duration-prerollEmbed.time();if(secondsLeft<1){presentz.play();}});prerollEmbed.bind("end",function(){prerollPlayer.fadeTo(300,0,'linear',function(){prerollEmbed.remove();console.log('test');prerollPlayer.css({"z-index":""});});});});var overlay=$('<div id="preroll-overlay" class="video-player flex-video widescreen"></div>');overlay.click(function(){$(".preroll-player").css({"z-index":10});prerollEmbed.play();overlay.remove();});overlay.insertAfter($('#video-player'));}
$().ready(function(){initPreroll(prerollID);$.get(slideSyncFile,function(json){initPresentz(json);});});}
function setupSideCalloutBlockPosition(){var $jsVideoRow=$(".js-video-row"),$jsSideCalloutBlock=$(".js-side-callout-block"),$window=$(window),windowHeightScrolled=$window.scrollTop()+$window.height(),sideCalloutHeight=$(".js-side-callout-message").height(),initialSideCalloutTopPosition=$jsVideoRow.offset().top+$jsVideoRow.height()+40,sideCalloutBottomPosition=initialSideCalloutTopPosition+sideCalloutHeight+30;$jsSideCalloutBlock.css("height",sideCalloutHeight);$jsSideCalloutBlock.attr("data-bottom-pos",sideCalloutBottomPosition);$jsSideCalloutBlock.attr("data-top-pos",initialSideCalloutTopPosition);if(windowHeightScrolled>sideCalloutBottomPosition){$jsSideCalloutBlock.css("position","fixed").css("top","initial");}else{$jsSideCalloutBlock.css("top",(initialSideCalloutTopPosition+"px"));}}
function setupSideCalloutScrollTracking(){var $jsSideCalloutBlock=$(".js-side-callout-block"),initialSideCalloutTopPosition=$jsSideCalloutBlock.attr("data-top-pos"),$window=$(window),windowHeightScrolled=$window.scrollTop()+$window.height(),sideCalloutBottomPosition=$jsSideCalloutBlock.attr("data-bottom-pos");$jsSideCalloutBlock.hide().css("visibility","visible").fadeIn();$window.scroll(function(){setSideCalloutPositionProperty($jsSideCalloutBlock,sideCalloutBottomPosition,initialSideCalloutTopPosition);});$window.resize(function(){setSideCalloutPositionProperty($jsSideCalloutBlock,sideCalloutBottomPosition,initialSideCalloutTopPosition);});}
function setSideCalloutPositionProperty(target,sideCalloutBottomPosition,initialSideCalloutTopPosition){var $window=$(window),windowHeightScrolled=$window.scrollTop()+$window.height();if($window.width()>1400){target.show();if(windowHeightScrolled>sideCalloutBottomPosition){target.css("position","fixed").css("top","initial");}else{target.css("position","absolute").css("top",(initialSideCalloutTopPosition+"px"));}}else{target.hide();}}
function runSidebarExperiment(variation){if(variation==1){var videoLoadedInterval=setInterval(function(){if($(".js-video-row").height()){setupSideCalloutBlockPosition();setupSideCalloutScrollTracking();clearInterval(videoLoadedInterval);return;}},100);}else{$(".js-side-callout-block").remove();}}
window._wq=window._wq||[];_wq.push({id:"_all",onReady:function(video){$('#playVideo').click(function(){video.play();$('.video-gallery').addClass('active');$('.blur-when-playing').addClass('active');});$('.close-video').click(function(){video.pause();$('.video-gallery').removeClass('active');$('.blur-when-playing').removeClass('active');});}});$('#playVideo').click(function(){if(typeof variable!=='undefined'){video.play();}
$('.video-gallery').addClass('active');$('.blur-when-playing').addClass('active');});$('.close-video').click(function(){if(typeof variable!=='undefined'){video.pause();}
$('.video-gallery').removeClass('active');$('.blur-when-playing').removeClass('active');});$('h3 a').click(function(){$('.video-gallery').addClass('active');$('.blur-when-playing').addClass('active');});